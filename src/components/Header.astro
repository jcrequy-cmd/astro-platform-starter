---
/*
  Header autonome : détecte la langue à partir de l'URL.
  Utilisable sans props : <Header />.
  Si besoin de forcer la langue : <Header lang="de" /> ou "fr".
*/
const forcedLang = Astro.props?.lang;
const detectedLang = Astro.url?.pathname?.startsWith('/de/') ? 'de'
                    : Astro.url?.pathname?.startsWith('/fr/') ? 'fr'
                    : null;

// Priorité : prop lang > détection URL > fallback 'fr'
const lang = forcedLang ?? detectedLang ?? 'fr';

const texts = {
  fr: {
    home: '/fr/',
    projets: '/fr/projets',
    statuts: '/fr/statuts',
    contact: '/fr/contact',
    title: 'Makerspace Biel-Bienne',
    navProjets: 'Projets',
    navStatuts: 'Statuts',
    navContact: 'Contact',
  },
  de: {
    home: '/de/',
    projets: '/de/projekte',
    statuts: '/de/statuten',
    contact: '/de/kontakt',
    title: 'Makerspace Biel-Bienne',
    navProjets: 'Projekte',
    navStatuts: 'Statuten',
    navContact: 'Kontakt',
  },
}[lang];
---

<header class="bg-white">
  <nav class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-6 flex items-center justify-between">
    <!-- Logo + titre -->
    <div class="flex items-center gap-3">
      <a href={texts.home}>
        <img src="/images/logo-msbb-1.png" alt="Logo du Makerspace Biel-Bienne" width="60" />
      </a>
      <span class="text-2xl font-semibold text-gray-900">{texts.title}</span>
    </div>

    <!-- Menu desktop -->
    <ul class="hidden md:flex items-center gap-10 text-gray-800 text-lg font-medium">
      <li><a href={texts.projets} class="hover:text-gray-500">{texts.navProjets}</a></li>
      <li><a href={texts.statuts} class="hover:text-gray-500">{texts.navStatuts}</a></li>
      <li><a href={texts.contact} class="hover:text-gray-500">{texts.navContact}</a></li>

      <!-- Lang switcher (ne fait que rediriger vers l'équivalent) -->
      <li class="flex items-center space-x-2">
        <button id="lang-fr" class="font-medium hover:text-primary" data-lang="fr">FR</button>
        <span>|</span>
        <button id="lang-de" class="font-medium hover:text-primary" data-lang="de">DE</button>
      </li>
    </ul>

    <!-- Mobile toggle -->
    <button id="menu-toggle" class="md:hidden text-gray-800 focus:outline-none" aria-label="Menu">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </nav>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="hidden flex-col items-center bg-white border-t border-gray-200 py-4 space-y-4 text-lg text-gray-800 md:hidden">
    <a href={texts.projets} class="hover:text-gray-500">{texts.navProjets}</a>
    <a href={texts.statuts} class="hover:text-gray-500">{texts.navStatuts}</a>
    <a href={texts.contact} class="hover:text-gray-500">{texts.navContact}</a>
    <div class="flex gap-2 pt-2">
      <button id="lang-fr-mobile" class="text-gray-700 hover:text-gray-900 font-medium" data-lang="fr">FR</button>
      <span>|</span>
      <button id="lang-de-mobile" class="text-gray-700 hover:text-gray-900 font-medium" data-lang="de">DE</button>
    </div>
  </div>
</header>

<hr class="border-gray-300 border-t mt-0 mb-1" />

<script>
  // mobile menu toggle
  document.getElementById('menu-toggle')?.addEventListener('click', () => {
    document.getElementById('mobile-menu')?.classList.toggle('hidden');
  });

  // language switcher: replace /fr/ <-> /de/ intelligently
  function switchLanguage(targetLang) {
    const path = window.location.pathname;
    // if on root or not language prefixed: redirect to targetLang home
    if (!path.startsWith('/fr/') && !path.startsWith('/de/')) {
      window.location.href = targetLang === 'de' ? '/de/' : '/fr/';
      return;
    }

    // try to map known pages: /fr/projets -> /de/projekte etc.
    // simple substitution for /fr/ <-> /de/
    if (targetLang === 'de') {
      window.location.href = path.replace(/^\/fr\//, '/de/');
    } else {
      window.location.href = path.replace(/^\/de\//, '/fr/');
    }
  }

  // attach handlers
  ['lang-fr','lang-de','lang-fr-mobile','lang-de-mobile'].forEach(id => {
    document.getElementById(id)?.addEventListener('click', (e) => {
      e.preventDefault();
      const target = e.currentTarget.getAttribute('data-lang');
      switchLanguage(target);
    });
  });
</script>
